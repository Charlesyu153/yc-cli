# Plan模式使用规范

## 何时使用Plan模式

### 必须使用的场景
1. **新功能实现**：添加有意义的新功能，需要设计实现方案
2. **多种实现方案**：任务可以用多种方式解决，需要选择最佳方案
3. **代码重构**：影响现有行为或结构的修改
4. **架构决策**：需要选择技术栈、设计模式或架构方案
5. **多文件修改**：预计会修改2-3个以上的文件
6. **需求不明确**：需要先探索代码库才能理解完整范围
7. **用户偏好重要**：实现方式有多种合理选择

### 不使用的场景
1. 单行或少量行的简单修复
2. 添加单个函数且需求明确
3. 用户已给出非常详细的实现指令
4. 纯研究/探索任务（使用Task tool with explore agent）

## Plan模式工作流程

### Phase 1: 探索阶段
```
1. 使用Glob/Grep/Read工具探索代码库
2. 理解现有架构和模式
3. 识别关键文件和依赖关系
4. 不要运行任何修改操作
```

### Phase 2: 设计阶段
```
1. 设计实现方案
2. 列出需要修改/创建的文件
3. 识别潜在风险和注意事项
4. 如有疑问，使用AskUserQuestion澄清
```

### Phase 3: 文档阶段
```
1. 将计划写入plan文件
2. 包含：目标、步骤、技术细节、验证方案
3. 使用ExitPlanMode请求用户批准
```

## Plan模式限制

### 只读操作
- ✓ 可以：Glob, Grep, Read, WebFetch, WebSearch
- ✗ 不可以：Edit, Write, Bash（除了读取操作）

### 文档操作
- ✓ 可以：编辑plan文件本身
- ✗ 不可以：修改项目代码文件

## 关键注意事项

1. **不要询问"计划是否可以"**：使用ExitPlanMode工具自动请求批准
2. **先澄清后计划**：如有疑问先用AskUserQuestion，不要在计划中留下未解决的问题
3. **计划要具体**：提供足够的技术细节，让实现阶段可以直接执行
4. **考虑验证**：在计划中包含测试和验证步骤
