#!/bin/bash
# post-commit hook - 提交后自动更新上下文

CONTEXT_SCRIPT="ai-docs/.context/scripts/update-context.sh"

# 检查脚本是否存在
if [ ! -f "$CONTEXT_SCRIPT" ]; then
    exit 0
fi

# 更新项目索引
"$CONTEXT_SCRIPT" --index 2>/dev/null || true

# 更新当前任务上下文
if [ -d "ai-docs/current" ]; then
    for task_dir in ai-docs/current/*/; do
        if [ -d "$task_dir" ]; then
            task_name=$(basename "$task_dir")
            "$CONTEXT_SCRIPT" --task "$task_name" 2>/dev/null || true
        fi
    done
fi

exit 0
